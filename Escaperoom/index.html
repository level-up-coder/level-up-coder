<!DOCTYPE html>
<html>
<head>
    <title>micro:bit Web Bluetooth</title>
</head>
<body>
    <h1>Micro:bit Web Controller</h1>
    <button id="connect">Connect to micro:bit</button>
    <p>Status: <span id="status">Disconnected</span></p>
    <p>Received Data: <b id="data">None</b></p>

    <script>
const UART_SERVICE = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const UART_RX    = '6e400002-b5a3-f393-e0a9-e50e24dcca9e'; // Web to micro:bit
const UART_TX    = '6e400003-b5a3-f393-e0a9-e50e24dcca9e'; // micro:bit to Web

async function onConnectButtonClick() {
    try {
        console.log('Requesting Bluetooth Device...');
        const device = await navigator.bluetooth.requestDevice({
            // We use namePrefix to find only micro:bits
            filters: [{ namePrefix: 'BBC micro:bit' }],
            // We MUST list the service here for the browser to allow access later
            optionalServices: [UART_SERVICE]
        });

        console.log('Connecting to GATT Server...');
        const server = await device.gatt.connect();

        console.log('Getting Service...');
        const service = await server.getPrimaryService(UART_SERVICE);

        console.log('Getting Characteristic...');
        const characteristic = await service.getCharacteristic(UART_TX);

        // Start receiving data
        await characteristic.startNotifications();
        characteristic.addEventListener('characteristicvaluechanged', (event) => {
            let value = new TextDecoder().decode(event.target.value);
            document.getElementById('data').innerText = value;
            console.log('Received:', value);
        });

        document.getElementById('status').innerText = "Connected to " + device.name;
    } catch (error) {
        console.error('Connection failed!', error);
        alert('Error: ' + error.message);
    }
}
    </script>
</body>
</html>